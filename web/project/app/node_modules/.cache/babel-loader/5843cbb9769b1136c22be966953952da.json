{"ast":null,"code":"var LRU = require(\"../../core/LRU\");\n\nvar globalImageCache = new LRU(50);\n/**\n * @param {string|HTMLImageElement|HTMLCanvasElement|Canvas} newImageOrSrc\n * @return {HTMLImageElement|HTMLCanvasElement|Canvas} image\n */\n\nfunction findExistImage(newImageOrSrc) {\n  if (typeof newImageOrSrc === 'string') {\n    var cachedImgObj = globalImageCache.get(newImageOrSrc);\n    return cachedImgObj && cachedImgObj.image;\n  } else {\n    return newImageOrSrc;\n  }\n}\n/**\n * Caution: User should cache loaded images, but not just count on LRU.\n * Consider if required images more than LRU size, will dead loop occur?\n *\n * @param {string|HTMLImageElement|HTMLCanvasElement|Canvas} newImageOrSrc\n * @param {HTMLImageElement|HTMLCanvasElement|Canvas} image Existent image.\n * @param {module:zrender/Element} [hostEl] For calling `dirty`.\n * @param {Function} [cb] params: (image, cbPayload)\n * @param {Object} [cbPayload] Payload on cb calling.\n * @return {HTMLImageElement|HTMLCanvasElement|Canvas} image\n */\n\n\nfunction createOrUpdateImage(newImageOrSrc, image, hostEl, cb, cbPayload) {\n  if (!newImageOrSrc) {\n    return image;\n  } else if (typeof newImageOrSrc === 'string') {\n    // Image should not be loaded repeatly.\n    if (image && image.__zrImageSrc === newImageOrSrc || !hostEl) {\n      return image;\n    } // Only when there is no existent image or existent image src\n    // is different, this method is responsible for load.\n\n\n    var cachedImgObj = globalImageCache.get(newImageOrSrc);\n    var pendingWrap = {\n      hostEl: hostEl,\n      cb: cb,\n      cbPayload: cbPayload\n    };\n\n    if (cachedImgObj) {\n      image = cachedImgObj.image;\n      !isImageReady(image) && cachedImgObj.pending.push(pendingWrap);\n    } else {\n      image = new Image();\n      image.onload = image.onerror = imageOnLoad;\n      globalImageCache.put(newImageOrSrc, image.__cachedImgObj = {\n        image: image,\n        pending: [pendingWrap]\n      });\n      image.src = image.__zrImageSrc = newImageOrSrc;\n    }\n\n    return image;\n  } // newImageOrSrc is an HTMLImageElement or HTMLCanvasElement or Canvas\n  else {\n    return newImageOrSrc;\n  }\n}\n\nfunction imageOnLoad() {\n  var cachedImgObj = this.__cachedImgObj;\n  this.onload = this.onerror = this.__cachedImgObj = null;\n\n  for (var i = 0; i < cachedImgObj.pending.length; i++) {\n    var pendingWrap = cachedImgObj.pending[i];\n    var cb = pendingWrap.cb;\n    cb && cb(this, pendingWrap.cbPayload);\n    pendingWrap.hostEl.dirty();\n  }\n\n  cachedImgObj.pending.length = 0;\n}\n\nfunction isImageReady(image) {\n  return image && image.width && image.height;\n}\n\nexports.findExistImage = findExistImage;\nexports.createOrUpdateImage = createOrUpdateImage;\nexports.isImageReady = isImageReady;","map":{"version":3,"names":["LRU","require","globalImageCache","findExistImage","newImageOrSrc","cachedImgObj","get","image","createOrUpdateImage","hostEl","cb","cbPayload","__zrImageSrc","pendingWrap","isImageReady","pending","push","Image","onload","onerror","imageOnLoad","put","__cachedImgObj","src","i","length","dirty","width","height","exports"],"sources":["F:/Wechatfile/WeChat Files/wxid_cre715h75uat22/FileStorage/MsgAttach/843d799c0bb5fd5ab828b2371b6d88b0/File/2022-07/project/project/app/node_modules/zrender/lib/graphic/helper/image.js"],"sourcesContent":["var LRU = require(\"../../core/LRU\");\n\nvar globalImageCache = new LRU(50);\n/**\n * @param {string|HTMLImageElement|HTMLCanvasElement|Canvas} newImageOrSrc\n * @return {HTMLImageElement|HTMLCanvasElement|Canvas} image\n */\n\nfunction findExistImage(newImageOrSrc) {\n  if (typeof newImageOrSrc === 'string') {\n    var cachedImgObj = globalImageCache.get(newImageOrSrc);\n    return cachedImgObj && cachedImgObj.image;\n  } else {\n    return newImageOrSrc;\n  }\n}\n/**\n * Caution: User should cache loaded images, but not just count on LRU.\n * Consider if required images more than LRU size, will dead loop occur?\n *\n * @param {string|HTMLImageElement|HTMLCanvasElement|Canvas} newImageOrSrc\n * @param {HTMLImageElement|HTMLCanvasElement|Canvas} image Existent image.\n * @param {module:zrender/Element} [hostEl] For calling `dirty`.\n * @param {Function} [cb] params: (image, cbPayload)\n * @param {Object} [cbPayload] Payload on cb calling.\n * @return {HTMLImageElement|HTMLCanvasElement|Canvas} image\n */\n\n\nfunction createOrUpdateImage(newImageOrSrc, image, hostEl, cb, cbPayload) {\n  if (!newImageOrSrc) {\n    return image;\n  } else if (typeof newImageOrSrc === 'string') {\n    // Image should not be loaded repeatly.\n    if (image && image.__zrImageSrc === newImageOrSrc || !hostEl) {\n      return image;\n    } // Only when there is no existent image or existent image src\n    // is different, this method is responsible for load.\n\n\n    var cachedImgObj = globalImageCache.get(newImageOrSrc);\n    var pendingWrap = {\n      hostEl: hostEl,\n      cb: cb,\n      cbPayload: cbPayload\n    };\n\n    if (cachedImgObj) {\n      image = cachedImgObj.image;\n      !isImageReady(image) && cachedImgObj.pending.push(pendingWrap);\n    } else {\n      image = new Image();\n      image.onload = image.onerror = imageOnLoad;\n      globalImageCache.put(newImageOrSrc, image.__cachedImgObj = {\n        image: image,\n        pending: [pendingWrap]\n      });\n      image.src = image.__zrImageSrc = newImageOrSrc;\n    }\n\n    return image;\n  } // newImageOrSrc is an HTMLImageElement or HTMLCanvasElement or Canvas\n  else {\n      return newImageOrSrc;\n    }\n}\n\nfunction imageOnLoad() {\n  var cachedImgObj = this.__cachedImgObj;\n  this.onload = this.onerror = this.__cachedImgObj = null;\n\n  for (var i = 0; i < cachedImgObj.pending.length; i++) {\n    var pendingWrap = cachedImgObj.pending[i];\n    var cb = pendingWrap.cb;\n    cb && cb(this, pendingWrap.cbPayload);\n    pendingWrap.hostEl.dirty();\n  }\n\n  cachedImgObj.pending.length = 0;\n}\n\nfunction isImageReady(image) {\n  return image && image.width && image.height;\n}\n\nexports.findExistImage = findExistImage;\nexports.createOrUpdateImage = createOrUpdateImage;\nexports.isImageReady = isImageReady;"],"mappings":"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"},"metadata":{},"sourceType":"script"}